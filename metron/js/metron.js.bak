// 全局主题js
    var KTAppOptions = {
        "colors": {
            "state": {
                "brand": "#366cf3",
                "light": "#ffffff",
                "dark": "#282a3c",
                "primary": "#5867dd",
                "success": "#34bfa3",
                "info": "#36a3f7",
                "warning": "#ffb822",
                "danger": "#fd3995"
            },
            "base": {
                "label": ["#c5cbe3", "#a1a8c3", "#3d4465", "#3e4466"],
                "shape": ["#f0f3ff", "#d9dffa", "#afb4d4", "#646c9a"]
            }
        }
    };
// 复制
    $(function () {
        new ClipboardJS('.copy-text');
    });
    $(".copy-text").click(function () {
        $.notify({
            message: '<strong>链接已复制到剪切板</strong>'
        },{
            type: 'success',
            placement: { 
                from: "top", 
                align: "right"
            },
            timer: 1500,
            animate: {
                enter: 'animated zoomIn',
                exit: 'animated zoomOut'
            }
        });
    });
// 签到
    $(document).ready(function () { 
        $("#checkin").click(function () {
            $("#checkin").text('正在签到');
            $('#checkin').addClass('kt-spinner kt-spinner--right kt-spinner--sm kt-spinner--light').attr('disabled', true);
            $.ajax({
                type: "POST",
                url: "/user/checkin",
                dataType: "json",
                success: function (data) {
                    setTimeout(function(){
                        $.notify({title: '<strong>签到成功</strong>',message: data.msg},{type: 'success',placement: { from: "top", align: "right"},timer: 1500,animate: {enter: 'animated zoomIn',exit: 'animated zoomOut'}});
                        $("#checkin").text('已签到');
                        $('#checkin').removeClass('btn btn-lg btn-danger kt-spinner kt-spinner--right kt-spinner--sm kt-spinner--light').addClass('btn btn-clean btn-bold btn-upper').attr('disabled', true);
                    },1000);
                },
                error: function (jqXHR) {
                    setTimeout(function(){
                        $.notify({title: '<strong>发生错误</strong>',message: jqXHR.status},{type: 'danger',placement: { from: "top", align: "right"},timer: 1500,animate: {enter: 'animated zoomIn',exit: 'animated zoomOut'}});
                        $("#checkin").text('签到');
                        $('#checkin').removeClass('kt-spinner kt-spinner--right kt-spinner--sm kt-spinner--light').attr('disabled', false);
                    },1000);
                }
            });
        })
    });
// 流量饼状图
    function trafficDountChat(lis,day,syu){
        Morris.Donut({
            element: 'morris-donut-chart',
            data: [{
                label: "历史使用",
                value: lis
            }, {
                label: "今日使用",
                value: day
            }, {
                label: "剩余流量",
                value: syu
            }],
            formatter: function (y) { return y + " %" },
            resize: true,
            colors:['#DCE6FD', '#83A4F4', '#5867dd']
        });
    };
// 判断是PC端
    function IsPC() {
        var userAgentInfo = navigator.userAgent;
        var Agents = ["Android", "iPhone",
            "SymbianOS", "Windows Phone",
            "iPad", "iPod"];
        var flag = true;
        for (var v = 0; v < Agents.length; v++) {
            if (userAgentInfo.indexOf(Agents[v]) > 0) {
                flag = false;
                break;
            }
        }
        return flag;
    }
// 判断是windows
    function IsWindows() {
        var agent = navigator.userAgent.toLowerCase();
        if (agent.indexOf("win32") >= 0 || agent.indexOf("wow32") >= 0) {
            return true
        } else if (agent.indexOf("win64") >= 0 || agent.indexOf("wow64") >= 0) {
            return true
        } else {
            return false
        }
    }
// 判断是mac
    function IsMac() {
        var agent = navigator.userAgent.toLowerCase();
        var MAC = /macintosh|mac os x/i.test(navigator.userAgent) && !window.MSStream;
        if(MAC){
            return true
        } else {
            return false
        }
    }
// 判断是Android
    function IsAndroid() {
        var u = navigator.userAgent;
        if (u.indexOf('Android') > -1 || u.indexOf('Adr') > -1) {
            return true
        } else {
            return false
        }
    }
// 判断是ios
    function IsiOS() {
        var u = navigator.userAgent;
        if (!!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)) {
            return true
        } else {
            return false
        }
    }
//一键导入
    function oneclickImport(client,url){
        if (client == 'ssr'){
            var url_base64=window.btoa(url)
            if (IsWindows()) {
                window.location.href = "sub://"+url_base64;
            } else {
                Swal.fire({
                    title: '您的设备可能不支持',
                    html: '<code>SSR</code>一键导入仅支持<code>Windows</code>端<code>SSR 5.1</code>以上版本',
                    type: 'warning',
                    showCancelButton: true,
                    confirmButtonText: '继续导入',
                    cancelButtonText: '取消'
                }).then((result) => {
                    if (result.value) {
                        window.location.href = "sub://"+url_base64;
                    }
                })
            }
        } 
        if (client == 'clashr'){
            if (IsWindows() || IsMac() || IsAndroid()) {
                window.location.href = "clash://install-config?url="+url;
            } else {
                Swal.fire({
                    title: '您的设备可能不支持',
                    html: '<code>ClashR</code>一键导入仅支持<code>Windows</code>、<code>Mac OS</code>和<code>Android</code>',
                    type: 'warning',
                    showCancelButton: true,
                    confirmButtonText: '继续导入',
                    cancelButtonText: '取消'
                }).then((result) => {
                    if (result.value) {
                        window.location.href = "clash://install-config?url="+url;
                    }
                })
            }
        }
        if (client == 'shadowrocket'){
            var url_base64=window.btoa(url)
            if (IsiOS()) {
                window.location.href = "sub://"+url_base64;
            } else {
                Swal.fire({
                    title: '您的设备可能不支持',
                    html: '<code>Shadowrocket</code>一键导入仅支持<code>Apple iOS</code>端设备',
                    type: 'warning',
                    showCancelButton: true,
                    confirmButtonText: '继续导入',
                    cancelButtonText: '取消'
                }).then((result) => {
                    if (result.value) {
                        window.location.href = "sub://"+url_base64;
                    }
                })
            }
        }
        if (client == 'quantumult'){
            var url_base64=window.btoa(url);
            var url_base64_nes=url_base64.replace(/=/g,"");
            if (IsiOS()) {
                window.location.href = "quantumult://configuration?server="+url_base64_nes;
            } else {
                Swal.fire({
                    title: '您的设备可能不支持',
                    html: '<code>Quantumult</code>一键导入仅支持<code>Apple iOS</code>端设备',
                    type: 'warning',
                    showCancelButton: true,
                    confirmButtonText: '继续导入',
                    cancelButtonText: '取消'
                }).then((result) => {
                    if (result.value) {
                        window.open("quantumult://configuration?server="+url_base64_nes)
                    }
                })
            }
        }
        if (client == 'quantumult_v2'){
            var url_base64=window.btoa(url);
            var url_base64_nes=url_base64.replace(/=/g,"");
            if (IsiOS()) {
                window.location.href = "quantumult://configuration?server="+url_base64_nes;
            } else {
                Swal.fire({
                    title: '您的设备可能不支持',
                    html: '<code>Quantumult</code>一键导入仅支持<code>Apple iOS</code>端设备',
                    type: 'warning',
                    showCancelButton: true,
                    confirmButtonText: '继续导入',
                    cancelButtonText: '取消'
                }).then((result) => {
                    if (result.value) {
                        window.location.href = "quantumult://configuration?server="+url_base64_nes;
                    }
                })
            }
        }
    }
//充值码
    $().ready(function() {
        $("#code-update").click(function () {
            var form = $(this).closest('#pay_code_form');
            form.validate({ //验证表单填写
                rules: {
                    pay_code: {
                        required: true
                    }
                },
                messages: {
                    pay_code: "请填写充值码"
                },
                errorPlacement: function(error, element) {
                    error.appendTo( element.parent() ); element.addClass('is-invalid');
                    error.addClass('invalid-feedback');
                }
            });
            if (!form.valid()) {
                return;
            }
            $("#code-update").text('正在兑换').addClass('kt-spinner kt-spinner--right kt-spinner--sm kt-spinner--light').attr('disabled', true);
            setTimeout(function(){
                $.ajax({
                    type: "POST",
                    url: "code",
                    dataType: "json",
                    data: {
                        code: $("#pay_code").val()
                    },
                    success: function (data) {
                        if (data.ret) {
                            Swal.fire({ type: "success",title: data.msg,timer: 1500,showConfirmButton: false });
                            $("#code-balance").load(location.href+" #code-balance-load");
                            $("#code-update").text('兑换').removeClass('kt-spinner kt-spinner--right kt-spinner--sm kt-spinner--light').attr('disabled', false);
                            //window.setTimeout("location.href=window.location.href", 1500);
                        } else {
                            Swal.fire({ type: "error",title: data.msg,timer: 1500,showConfirmButton: false });
                            $("#code-update").text('兑换').removeClass('kt-spinner kt-spinner--right kt-spinner--sm kt-spinner--light').attr('disabled', false);
                        }
                    },
                    error: function (jqXHR) {
                        Swal.fire({ type: "error",title: '发生错误：' + jqXHR.status });
                        $("#code-update").text('兑换').removeClass('kt-spinner kt-spinner--right kt-spinner--sm kt-spinner--light').attr('disabled', false);
                    }
                });
            },1000);
        });
    });

    $("#tomato-alipay").click(function(){
        var pid = 0;
        var type = 'alipay';
        var price = parseFloat($("#tomato-amount").val());
        var form = $(this).closest('#pay_tomato_amount');
        form.validate({
            rules: {
                tomato_amount: {
                    required: true
                }
            },
            messages: {
                tomato_amount: "请填写金额"
            },
            errorPlacement: function(error, element) {
                error.appendTo( element.parent() ); element.addClass('is-invalid');
                error.addClass('invalid-feedback');
            }
        });
        if (!form.valid()) {
            return;
        }
        $("#tomato-alipay").text('正在发起支付请求').addClass('kt-spinner kt-spinner--right kt-spinner--sm kt-spinner--light').attr('disabled', true);
        setTimeout(function(){
            $.ajax({
                url: "/user/payment/purchase",
                data: {
                    price: price,
                    type: type,
                },
                dataType: 'json',
                type: "POST",
                success:function(data){
                    $("#tomato-alipay").text('支付宝').removeClass('kt-spinner kt-spinner--right kt-spinner--sm kt-spinner--light').attr('disabled', false);
                    if(data.errcode==-1){
                    Swal.fire({ type: "error",title: data.errmsg,timer: 1500,showConfirmButton: false });
                    }
                    if(data.errcode==0){
                    pid = data.pid;
                    setTimeout(function(){ window.location.href=data.code; }, 0);
                    }
                },
                error: function (jqXHR) {
                    $("#tomato-alipay").text('支付宝').removeClass('kt-spinner kt-spinner--right kt-spinner--sm kt-spinner--light').attr('disabled', false);
                    Swal.fire({ type: "error",title: '发生错误 '+ jqXHR.status });
                }
            });
        },1000);
    });
    $("#tomato-wxpay").click(function(){
        var pid = 0;
        var type = 'wxpay';
        var price = parseFloat($("#tomato-amount").val());
        var form = $(this).closest('#pay_tomato_amount');
        form.validate({
            rules: {
                tomato_amount: {
                    required: true
                }
            },
            messages: {
                tomato_amount: "请填写金额"
            },
            errorPlacement: function(error, element) {
                error.appendTo( element.parent() ); element.addClass('is-invalid');
                error.addClass('invalid-feedback');
            }
        });
        if (!form.valid()) {
            return;
        }
        $("#tomato-wxpay").text('正在发起支付请求').addClass('kt-spinner kt-spinner--right kt-spinner--sm kt-spinner--light').attr('disabled', true);
        setTimeout(function(){
            $.ajax({
                url: "/user/payment/purchase",
                data: {
                    price: price,
                    type: type,
                },
                dataType: 'json',
                type: "POST",
                success:function(data){
                    $("#tomato-wxpay").text('微信').removeClass('kt-spinner kt-spinner--right kt-spinner--sm kt-spinner--light').attr('disabled', false);
                    if(data.errcode==-1){
                    Swal.fire({ type: "error",title: data.errmsg,timer: 1500,showConfirmButton: false });
                    }
                    if(data.errcode==0){
                    pid = data.pid;
                    setTimeout(function(){ window.location.href=data.code; }, 0);
                    }
                },
                error: function (jqXHR) {
                    $("#tomato-wxpay").text('微信').removeClass('kt-spinner kt-spinner--right kt-spinner--sm kt-spinner--light').attr('disabled', false);
                    Swal.fire({ type: "error",title: '发生错误 '+ jqXHR.status });
                }
            });
        },1000);
    });

    function nobuy(id,auto,userclass) {
        if(auto==0){
              document.getElementById('autor').style.display="none";
          }else{
              document.getElementById('autor').style.display="";
          }
          shop=id;
        Swal.fire({
          title: '请注意',
          html: '您当前会员等级为 <code>Lv.'+userclass+'</code>，与将要 <code>购买的套餐等级价值不同</code>，无法自助升级；继续购买将导致您的会员时长清零并按新套餐重新计算！如有需要请联系客服升级！',
          type: 'warning',
          showCancelButton: true,
          confirmButtonText: '继续购买',
          cancelButtonText: '取消'
        }).then((result) => {
          if (result.value) {
            $("#coupon_modal").modal();
          }
        })
      }
      function buy(id,auto) {
        if(auto==0){
          document.getElementById('autor').style.display="none";
        }else{
          document.getElementById('autor').style.display="";
        }
        shop=id;
        $("#coupon_modal").modal();
      }

      $("#coupon_input").click(function () {
        $.ajax({
          type: "POST",
          url: "coupon_check",
          dataType: "json",
          data: {
            coupon: $("#coupon").val(),
            shop: shop
          },
          success: function (data) {
            if (data.ret) {
              $("#name").html("商品名称："+data.name);
              $("#credit").html("优惠额度："+data.credit);
              $("#total").html("总金额："+data.total);
              $("#order_modal").modal();
            } else {
              Swal.fire({ type: "error",title: data.msg }); 
            }
          },
          error: function (jqXHR) {
            Swal.fire({ type: "error",title: '发生错误',html: data.msg }); 
          }
        })
      });
      $("#order_input").click(function () {
        if(document.getElementById('autorenew').checked){
              var autorenew=1;
          }else{
              var autorenew=0;
          }
          if(document.getElementById('disableothers').checked){
              var disableothers=1;
          }else{
              var disableothers=0;
          }
          $.ajax({
          type: "POST",
          url: "buy",
          dataType: "json",
          data: {
          coupon: $("#coupon").val(),
          shop: shop,
          autorenew: autorenew,
          disableothers:disableothers
              },
              success: function (data) {
                  if (data.ret) {
                      Swal.fire({ type: "success",title: data.msg }); 
                      window.setTimeout("location.href='/user'", 1500);
                  } else {
                      Swal.fire({ type: "warning",title: "余额不足",html: data.msg+"<br>请充值足够余额后再来购买套餐~"}); 
                  }
              },
              error: function (jqXHR) {
            Swal.fire({ type: "error",title: data.msg+"  发生了错误。" }); 
              }
          })
      });